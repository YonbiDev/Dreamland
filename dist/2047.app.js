"use strict";(self.webpackChunkbabylonjs=self.webpackChunkbabylonjs||[]).push([[2047],{2047:(t,n,i)=>{i.r(n),i.d(n,{FlowGraphPlayAnimationBlock:()=>s});var e=i(1e3),o=i(4720),r=i(6552),a=i(5879);class s extends e.M{constructor(t){super(t,["animationLoop","animationEnd","animationGroupLoop"]),this.config=t,this.speed=this.registerDataInput("speed",o.Es),this.loop=this.registerDataInput("loop",o.RI),this.from=this.registerDataInput("from",o.Es,0),this.to=this.registerDataInput("to",o.Es),this.currentFrame=this.registerDataOutput("currentFrame",o.Es),this.currentTime=this.registerDataOutput("currentTime",o.Es),this.currentAnimationGroup=this.registerDataOutput("currentAnimationGroup",o.Vv),this.animationGroup=this.registerDataInput("animationGroup",o.Vv,t?.animationGroup),this.animation=this.registerDataInput("animation",o.Vv),this.object=this.registerDataInput("object",o.Vv)}_preparePendingTasks(t){const n=this.animationGroup.getValue(t),i=this.animation.getValue(t);if(!n&&!i)return this._reportError(t,"No animation or animation group provided");{const e=this.currentAnimationGroup.getValue(t);e&&e!==n&&e.dispose();let o=n;if(i&&!o){const n=this.object.getValue(t);if(!n)return this._reportError(t,"No target object provided");const e=Array.isArray(i)?i:[i],r=e[0].name;o=new a.AnimationGroup("flowGraphAnimationGroup-"+r+"-"+n.name,t.configuration.scene);let s=!1;const u=t._getGlobalContextVariable("interpolationAnimations",[]);for(const t of e)o.addTargetedAnimation(t,n),-1!==u.indexOf(t.uniqueId)&&(s=!0);s&&this._checkInterpolationDuplications(t,e,n)}const r=this.speed.getValue(t)||1,s=this.from.getValue(t)??0,u=this.to.getValue(t)||o.to,p=!isFinite(u)||this.loop.getValue(t);this.currentAnimationGroup.setValue(o,t);const l=t._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);-1!==l.indexOf(o.uniqueId)&&o.stop();try{o.start(p,r,s,u),o.onAnimationGroupEndObservable.add((()=>this._onAnimationGroupEnd(t))),o.onAnimationEndObservable.add((()=>this._eventsSignalOutputs.animationEnd._activateSignal(t))),o.onAnimationLoopObservable.add((()=>this._eventsSignalOutputs.animationLoop._activateSignal(t))),o.onAnimationGroupLoopObservable.add((()=>this._eventsSignalOutputs.animationGroupLoop._activateSignal(t))),l.push(o.uniqueId),t._setGlobalContextVariable("currentlyRunningAnimationGroups",l)}catch(n){this._reportError(t,n)}}}_reportError(t,n){super._reportError(t,n),this.currentFrame.setValue(-1,t),this.currentTime.setValue(-1,t)}_executeOnTick(t){const n=this.currentAnimationGroup.getValue(t);n&&(this.currentFrame.setValue(n.getCurrentFrame(),t),this.currentTime.setValue(n.animatables[0]?.elapsedTime??0,t))}_execute(t){this._startPendingTasks(t)}_onAnimationGroupEnd(t){this._removeFromCurrentlyRunning(t,this.currentAnimationGroup.getValue(t)),this._resetAfterCanceled(t),this.done._activateSignal(t)}_checkInterpolationDuplications(t,n,i){const e=t._getGlobalContextVariable("currentlyRunningAnimationGroups",[]);for(const o of e){const e=t.assetsContext.animationGroups.find((t=>t.uniqueId===o));if(e)for(const o of e.targetedAnimations)for(const r of n)o.animation.targetProperty===r.targetProperty&&o.target===i&&this._stopAnimationGroup(t,e)}}_stopAnimationGroup(t,n){n.stop(!0),n.dispose(),this._removeFromCurrentlyRunning(t,n)}_removeFromCurrentlyRunning(t,n){const i=t._getGlobalContextVariable("currentlyRunningAnimationGroups",[]),e=i.indexOf(n.uniqueId);-1!==e&&(i.splice(e,1),t._setGlobalContextVariable("currentlyRunningAnimationGroups",i))}_cancelPendingTasks(t){const n=this.currentAnimationGroup.getValue(t);n&&this._stopAnimationGroup(t,n)}getClassName(){return"FlowGraphPlayAnimationBlock"}}(0,r.Y5)("FlowGraphPlayAnimationBlock",s)}}]);